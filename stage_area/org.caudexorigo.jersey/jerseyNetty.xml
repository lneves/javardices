<project name="netty-http-jersey" default="jar" basedir=".">
	<description>
        Jersey container with Netty protype
    </description>
	<property name="src" location="src" />
	<property name="build" location="build" />
	<property name="bin" location="bin" />
	<property name="classes" location="${build}/classes" />
	<property name="dist" location="${build}/dist" />
	<property name="main.class" value="org.caudexorigo.jersey.netty.http.examples.MainJerseyNetty4HttpServer" />

	<property name="lib" value="lib" />

	<path id="classpath">
		<fileset dir="${lib}">
			<include name="/**.jar" />
		</fileset>
	</path>

	<target name="init">
		<tstamp />
		<mkdir dir="${build}" />
		<mkdir dir="${classes}" />
	</target>

	<target name="compile" depends="init" description="compile the source ">
		<javac srcdir="${src}" destdir="${classes}" classpathref="classpath"/>
		<copy todir="${build}\conf">
			<fileset dir="conf" excludes="**/*.java" />
		</copy>
		<copy todir="${build}\ssl">
			<fileset dir="ssl" excludes="**/*.java" />
		</copy>
		<copy todir="${classes}">
			<fileset dir="src" includes="**/*.gif" />
		</copy>
	</target>

	<pathconvert property="mf.classpath" pathsep=" ">
	    <path refid="classpath" />
	    <flattenmapper/>
	</pathconvert>
	
	<target name="jar" depends="compile" description="create jar file">
		<mkdir dir="${dist}" />
		<jar destfile="${dist}/${ant.project.name}.jar">
			<manifest>
			  <attribute name="Built-Date" value="${TODAY}"/>
			  <attribute name="Main-Class" value="${main.class}"/>
			  <attribute name="Class-Path" value="${mf.classpath}" />
			</manifest>
			<fileset dir="${classes}" includes="**/*" />
			<fileset dir="${lib}" includes="/*.jar" />
		</jar>
	</target>

	<path id="application" location="${dist}/${ant.project.name}.jar" />

	<property name="report.dir" value="${build}\junitreport" />

	<target name="testandjar" depends="jar" description="tests and creates jar file">
		<mkdir dir="${report.dir}" />
		<junit printsummary="yes" failureproperty="junit.failure">
			<classpath>
				<path refid="classpath" />
				<path refid="application" />
			</classpath>
			<test name="org.caudexorigo.jersey.netty.http.tests.NettyHttpTest" haltonerror="true" />
			<formatter type="xml" />
		</junit>
		<junitreport todir="${report.dir}">
			<fileset dir="${report.dir}" includes="TEST-*.xml" />
			<report todir="${report.dir}" />
		</junitreport>
		<fail if="junit.failure" message="Tests failed"/>
	</target>

	<target name="clean" description="clean up">
		<delete dir="${build}" />
	</target>
	
</project>