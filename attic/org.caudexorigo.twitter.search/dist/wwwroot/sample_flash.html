<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Flash Base Web Socket Support</title>

<script type="text/javascript" src="swfobject.js"></script>
<script type="text/javascript" src="FABridge.js"></script>
<script type="text/javascript" src="web_socket.js"></script>

<script type="text/javascript">
    
//Set URL of your WebSocketMain.swf here:
WebSocket.__swfLocation = "WebSocketMain.swf";
var ws_host = "ws://" + window.location.host + "/";
var ws;

function init() {

    if (window.WebSocket) {

        // Connect to Web Socket.
        // Change host/port here to your own Web Socket server.
        ws = new WebSocket(ws_host);
        
  	  output("Your browser rocks! It supports Web Sockets.");
    } else {
  	  output("This sucks! Your browser doesn't have Web Sockets.");
    }



    // Set event handlers.
    ws.onopen = function () {
  	  output("Web Socket Opened");
    };
    ws.onmessage = function (event) {
        // e.data contains received string.
        output("onmessage: " + event.data);
    };
    ws.onclose = function () {
  	  output("Web Socket Closed");
    };

}

function doSend() {

    var input = document.getElementById("input");

	if (window.WebSocket)
	{
   		try {ws.send(input.value);output("send: " + input.value);}
    	catch(err) {output("oops! something is wrong: " + err.message); }
	}
	else
	{
		output("Give up, this browser doesn't support WebSockets");
    }
    
    input.value = "";
    input.focus();
    return false;
}

function doClose() {
    ws.close();
    return false;
}

function output(str) {
    var log = document.getElementById("log");
    var escaped = str.replace(/&/, "&amp;").replace(/</, "&lt;").
    replace(/>/, "&gt;").replace(/"/, "&quot;"); // "
    log.innerHTML = escaped + "<br>" + log.innerHTML;
}

  </script>
</head>
<body onload="init();">

<form onsubmit="return doSend();">
<input type="text" id="input">
<input type="submit" value="Send">
<button onclick="return doClose();">Close</button>
</form>

<div id="log"></div>

</body>
</html>
